[gd_scene format=3 uid="uid://bdyigy4fvbvtr"]

[ext_resource type="Script" uid="uid://o3eg7vjc47t7" path="res://scripts/main.gd" id="1_o6xl0"]
[ext_resource type="PackedScene" uid="uid://cxpd0mkp6cky5" path="res://scenes/objects/crafting_table.tscn" id="2_nvumn"]
[ext_resource type="PackedScene" uid="uid://bs72ogkvdd7d6" path="res://scenes/main/player.tscn" id="2_tipki"]
[ext_resource type="Script" uid="uid://dl3mfoi35lg5w" path="res://scripts/UI/show_coordinates.gd" id="3_85g3d"]
[ext_resource type="Script" uid="uid://pl3n7g23c7ip" path="res://scripts/world_environment.gd" id="4_blune"]
[ext_resource type="PackedScene" uid="uid://laa6wkcpj3ws" path="res://scenes/UI/hotbar.tscn" id="4_choun"]
[ext_resource type="Texture2D" uid="uid://dahs8mhn1hp1t" path="res://ressources/pictures/Items/Stone.png" id="5_nvumn"]
[ext_resource type="Texture2D" uid="uid://2lg3o2g67vdp" path="res://ressources/pictures/UI/crosshair.png" id="5_ya4ey"]
[ext_resource type="PackedScene" uid="uid://equrnyrs8b8x" path="res://scenes/UI/pause_menu.tscn" id="6_eb6dy"]
[ext_resource type="PackedScene" uid="uid://bb4fk5cvhk80y" path="res://scenes/objects/items/stone.tscn" id="6_ou6is"]
[ext_resource type="AudioStream" uid="uid://1o10fnhinqcg" path="res://ressources/sounds/place.mp3" id="7_necax"]
[ext_resource type="AudioStream" uid="uid://chrw4bninhbgo" path="res://ressources/sounds/backgroundMusic.mp3" id="7_trceg"]
[ext_resource type="PackedScene" uid="uid://cq8sbte51hdu2" path="res://scenes/UI/inventory.tscn" id="8_b1x3f"]
[ext_resource type="Resource" uid="uid://bjj74et774x7v" path="res://items/inventory_items/blocks/wood.tres" id="8_ou6is"]
[ext_resource type="PackedScene" uid="uid://bhq5ow250herw" path="res://scenes/main/enemy.tscn" id="11_r4lks"]
[ext_resource type="PackedScene" uid="uid://dr1hqhhyvv47c" path="res://scenes/objects/oxygen_tank.tscn" id="12_blune"]
[ext_resource type="Script" uid="uid://dwdabywcheuay" path="res://items/item.gd" id="13_7smn1"]
[ext_resource type="PackedScene" uid="uid://dr230symovhoe" path="res://scenes/objects/chest.tscn" id="13_th5th"]

[sub_resource type="NavigationMesh" id="NavigationMesh_ouso4"]
vertices = PackedVector3Array(120.84801, 0.5, -50.651993, 101.59801, 0.5, -97.90199, 100.09801, 0.5, -100.65199, 0.5980072, 0.5, -141.902, -0.4019928, 0.5, -141.902, 0.5980072, 0.5, -50.651993, -100.15199, 0.5, -100.65199, -120.90199, 0.5, -50.651993, -0.6519928, 0.5, -50.651993, -141.902, 0.5, -0.4019928, -141.902, 0.5, 0.5980072, -120.90199, 0.5, 50.598007, -50.651993, 0.5, 0.5980072, -50.651993, 0.5, -0.6519928, -36.151993, 0.5, -35.651993, -36.151993, 0.5, 35.598007, -0.6519928, 0.5, 50.598007, -34.651993, 0.5, 36.598007, 140.348, 0.5, 4.348007, 141.848, 0.5, 0.5980072, 141.848, 0.5, -0.6519928, 120.84801, 0.5, 50.598007, 50.598007, 0.5, -0.6519928, 50.598007, 0.5, 0.8480072, 36.098007, 0.5, 35.848007, 0.8480072, 0.5, 50.598007, 35.598007, 0.5, -36.151993, 36.598007, 0.5, -34.651993, 0.3480072, 1, -1.9019928, 48.848007, 1, -1.9019928, 35.098007, 1, -35.151993, -0.1519928, 1, -49.651993, -35.151993, 1, -35.151993, -48.651993, 1, -1.9019928, -0.4019928, 1, -1.9019928, -49.651993, 1, -0.1519928, -48.651993, 1, 1.8480072, -1.6519928, 1, 1.0980072, -1.9019928, 1, -0.4019928, -0.6519928, 1, 1.8480072, -1.6519928, 1, -1.1519928, 1.5980072, 1, -1.1519928, 1.8480072, 1, 0.0980072, 4.098007, 1, 0.0980072, 5.098007, 1, 0.0980072, 49.598007, 1, 0.0980072, -0.6519928, 4.5, 0.5980072, 0.0980072, 4.5, 0.8480072, 0.8480072, 4.5, 0.0980072, 0.5980072, 4.5, -0.6519928, -0.6519928, 4.5, -0.6519928, -0.4019928, 1, -0.4019928, -0.4019928, 1, 0.3480072, 0.3480072, 1, 0.3480072, 0.3480072, 1, -0.4019928, 3.0980072, 1, 0.8480072, 1.8480072, 1, 0.8480072, -48.651993, 1, 2.3480072, -3.9019928, 1, 2.3480072, 3.5980072, 1, 2.3480072, 0.8480072, 1, 1.8480072, -2.6519928, 1, 2.3480072, 5.848007, 1, 2.0980072, 4.848007, 1, 2.8480072, 48.348007, 1, 2.8480072, 5.848007, 1, 1.0980072, -47.151993, 1, 5.598007, -4.401993, 1, 5.598007, -5.151993, 1, 4.848007, -5.151993, 1, 4.098007, -1.9019928, 1, 3.3480072, 3.8480072, 1, 2.8480072, 6.598007, 1, 3.3480072, 48.098007, 1, 3.3480072, 5.848007, 1, 3.3480072, 4.848007, 1, 4.098007, 4.848007, 1, 5.348007, 5.598007, 1, 6.098007, -3.1519928, 1, 5.598007, -46.901993, 1, 6.098007, 7.348007, 1, 5.348007, 6.598007, 1, 6.098007, 47.098007, 1, 6.098007, 7.348007, 1, 4.348007, 35.098007, 1, 35.098007, -0.1519928, 1, 49.598007, -35.151993, 1, 35.098007, -0.6519928, 0.5, 141.848, 0.5980072, 0.5, 141.848, 4.348007, 0.5, 140.348, 100.09801, 0.5, 100.59801, 101.09801, 0.5, 99.09801, -100.15199, 0.5, 100.59801)
polygons = [PackedInt32Array(1, 0, 2), PackedInt32Array(2, 0, 5), PackedInt32Array(2, 5, 3), PackedInt32Array(3, 5, 4), PackedInt32Array(7, 6, 8), PackedInt32Array(8, 6, 4), PackedInt32Array(4, 5, 8), PackedInt32Array(10, 9, 11), PackedInt32Array(11, 9, 7), PackedInt32Array(11, 7, 13), PackedInt32Array(11, 13, 12), PackedInt32Array(7, 8, 14), PackedInt32Array(7, 14, 13), PackedInt32Array(12, 15, 11), PackedInt32Array(17, 16, 11), PackedInt32Array(15, 17, 11), PackedInt32Array(20, 19, 18), PackedInt32Array(18, 21, 20), PackedInt32Array(20, 21, 0), PackedInt32Array(0, 21, 22), PackedInt32Array(22, 21, 23), PackedInt32Array(21, 25, 24), PackedInt32Array(21, 24, 23), PackedInt32Array(0, 26, 5), PackedInt32Array(27, 26, 0), PackedInt32Array(22, 27, 0), PackedInt32Array(29, 28, 30), PackedInt32Array(30, 28, 31), PackedInt32Array(33, 32, 34), PackedInt32Array(34, 32, 31), PackedInt32Array(31, 28, 34), PackedInt32Array(35, 33, 36), PackedInt32Array(36, 33, 38), PackedInt32Array(36, 38, 37), PackedInt32Array(37, 39, 36), PackedInt32Array(33, 34, 40), PackedInt32Array(33, 40, 38), PackedInt32Array(43, 42, 41), PackedInt32Array(44, 43, 41), PackedInt32Array(41, 28, 44), PackedInt32Array(44, 28, 29), PackedInt32Array(44, 29, 45), PackedInt32Array(47, 46, 48), PackedInt32Array(48, 46, 49), PackedInt32Array(49, 46, 50), PackedInt32Array(54, 53, 51), PackedInt32Array(51, 53, 52), PackedInt32Array(56, 42, 55), PackedInt32Array(55, 42, 43), PackedInt32Array(57, 36, 58), PackedInt32Array(58, 36, 39), PackedInt32Array(56, 55, 60), PackedInt32Array(60, 55, 59), PackedInt32Array(39, 61, 58), PackedInt32Array(39, 60, 61), PackedInt32Array(61, 60, 59), PackedInt32Array(64, 63, 62), PackedInt32Array(64, 62, 65), PackedInt32Array(65, 44, 64), PackedInt32Array(64, 44, 45), PackedInt32Array(68, 67, 66), PackedInt32Array(69, 68, 66), PackedInt32Array(69, 66, 58), PackedInt32Array(58, 66, 57), PackedInt32Array(71, 70, 59), PackedInt32Array(59, 70, 61), PackedInt32Array(73, 72, 64), PackedInt32Array(64, 72, 63), PackedInt32Array(63, 74, 71), PackedInt32Array(71, 74, 70), PackedInt32Array(72, 74, 63), PackedInt32Array(70, 74, 75), PackedInt32Array(70, 75, 76), PackedInt32Array(76, 77, 70), PackedInt32Array(70, 77, 78), PackedInt32Array(66, 67, 79), PackedInt32Array(79, 67, 77), PackedInt32Array(67, 78, 77), PackedInt32Array(80, 82, 81), PackedInt32Array(82, 80, 83), PackedInt32Array(83, 72, 82), PackedInt32Array(82, 72, 73), PackedInt32Array(81, 82, 84), PackedInt32Array(77, 81, 84), PackedInt32Array(84, 85, 77), PackedInt32Array(77, 85, 86), PackedInt32Array(77, 86, 79), PackedInt32Array(89, 88, 87), PackedInt32Array(91, 90, 21), PackedInt32Array(21, 90, 25), PackedInt32Array(25, 90, 89), PackedInt32Array(25, 89, 87), PackedInt32Array(11, 16, 92), PackedInt32Array(92, 16, 87), PackedInt32Array(16, 25, 87)]
sample_partition_type = 1
geometry_parsed_geometry_type = 1
agent_radius = 0.4

[sub_resource type="GDScript" id="GDScript_ouso4"]
script/source = "extends NavigationRegion3D

@export var mob_scene: PackedScene
@export var player: CharacterBody3D
@export var worldEnvironment: WorldEnvironment

@onready var blocks := $World_flexible/Blocks
var bake_queued := false



func _ready():
	pass




func queue_bake():
	if bake_queued:
		return
	bake_queued = true
	call_deferred(\"_do_bake\")

func _do_bake():
	await get_tree().physics_frame
	navigation_mesh = navigation_mesh.duplicate()
	bake_navigation_mesh()
	bake_queued = false

func is_day() -> bool:
	var day = worldEnvironment.get_day()
	return day

	

func _on_world_flexible_child_order_changed() -> void:
	queue_bake()

func _on_mob_timer_timeout():
	if true:
		return
	# Create a new instance of the Mob scene.
	var mob = mob_scene.instantiate()

	# Choose a random location on the SpawnPath.
	# We store the reference to the SpawnLocation node.
	var mob_spawn_location = get_node(\"Spawnpath/PathFollow3D\")
	# And give it a random offset.
	mob_spawn_location.progress_ratio = randf()

	var player_position = player.position
	mob.initialize(mob_spawn_location.position, player_position)

	# Spawn the mob by adding it to the Main scene.
	add_child(mob)
	
"

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_272bh"]
albedo_color = Color(0, 0.54525805, 2.8878452e-07, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_5vw27"]
albedo_color = Color(0, 0.7735731, 1, 1)

[sub_resource type="Resource" id="Resource_ou6is"]
resource_local_to_scene = true
script = ExtResource("13_7smn1")
name = "Stone"
icon = ExtResource("5_nvumn")
count = 30
scene = ExtResource("6_ou6is")
sound = ExtResource("7_necax")
metadata/_custom_type_script = "uid://dwdabywcheuay"

[sub_resource type="Resource" id="Resource_necax"]
resource_local_to_scene = true
script = ExtResource("13_7smn1")
name = "Stone"
icon = ExtResource("5_nvumn")
count = 50
scene = ExtResource("6_ou6is")
sound = ExtResource("7_necax")
metadata/_custom_type_script = "uid://dwdabywcheuay"

[sub_resource type="Curve3D" id="Curve3D_necax"]
closed = true
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, -0.18897486, 0, -48.908566, 0, 0, 0, 0, 0, 0, -34.191788, 0, -34.747196, 0, 0, 0, 0, 0, 0, -48.163837, 0, 0.18291953, 0, 0, 0, 0, 0, 0, -34.44413, 0, 32.14726, 0, 0, 0, 0, 0, 0, 0.023118496, 0, 49.05778, 0, 0, 0, 0, 0, 0, 33.78486, 0, 34.276524, 0, 0, 0, 0, 0, 0, 48.23017, 0, -0.32505414, 0, 0, 0, 0, 0, 0, 32.841, 0, -33.13),
"tilts": PackedFloat32Array(0, 0, 0, 0, 0, 0, 0, 0)
}
point_count = 8

[sub_resource type="PhysicalSkyMaterial" id="PhysicalSkyMaterial_ouso4"]

[sub_resource type="Sky" id="Sky_ig7tw"]
sky_material = SubResource("PhysicalSkyMaterial_ouso4")

[sub_resource type="Environment" id="Environment_0xm2m"]
background_mode = 2
sky = SubResource("Sky_ig7tw")
tonemap_mode = 2
glow_enabled = true

[node name="Main" type="Node3D" unique_id=1623769975 node_paths=PackedStringArray("musicPlayer")]
script = ExtResource("1_o6xl0")
musicPlayer = NodePath("MusicPlayer")

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="." unique_id=258587123 node_paths=PackedStringArray("player", "worldEnvironment")]
navigation_mesh = SubResource("NavigationMesh_ouso4")
navigation_layers = 255
script = SubResource("GDScript_ouso4")
mob_scene = ExtResource("11_r4lks")
player = NodePath("../Player")
worldEnvironment = NodePath("../WorldEnvironment")

[node name="World_fixed" type="Node" parent="NavigationRegion3D" unique_id=695680520]

[node name="Oxygentank" parent="NavigationRegion3D/World_fixed" unique_id=1969997739 instance=ExtResource("12_blune")]
transform = Transform3D(2.305, 0, 0, 0, 2.305, 0, 0, 0, 2.305, 0, 0, 0)

[node name="OxygenTankLabel" type="Label3D" parent="NavigationRegion3D/World_fixed/Oxygentank" unique_id=573855338]
transform = Transform3D(0.43383947, 0, 0, 0, 0.43383947, 0, 0, 0, 0.43383947, 0, 2.4693522, 0)
text = "Beschütze!
↓"
font_size = 128

[node name="ChestLabel3" type="Label3D" parent="NavigationRegion3D/World_fixed/Oxygentank" unique_id=1891736032]
transform = Transform3D(0.43383938, 0, 0, 0, 0.43383947, 0, 0, 0, 0.43383938, 0, 0.92873853, 0.7419561)
text = "Drücke Tab um das Inventar zu öffnen"

[node name="Floor" type="CSGCylinder3D" parent="NavigationRegion3D/World_fixed" unique_id=1262442530]
use_collision = true
radius = 50.0
height = 1.0
material = SubResource("StandardMaterial3D_272bh")

[node name="Sea" type="CSGCylinder3D" parent="NavigationRegion3D/World_fixed/Floor" unique_id=655570295]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0)
radius = 142.402
material = SubResource("StandardMaterial3D_5vw27")

[node name="Chests" type="Node" parent="NavigationRegion3D/World_fixed" unique_id=1960681214]

[node name="Chest" parent="NavigationRegion3D/World_fixed/Chests" unique_id=684924033 instance=ExtResource("13_th5th")]
transform = Transform3D(-0.51225275, 0, 0.85883474, 0, 1, 0, -0.85883474, 0, -0.51225275, 6.111495, 0.9, 4.772731)
chest_items = Array[ExtResource("13_7smn1")]([SubResource("Resource_ou6is"), null, null, null, null, null, null, null, SubResource("Resource_necax"), null])

[node name="ChestLabel2" type="Label3D" parent="NavigationRegion3D/World_fixed/Chests/Chest" unique_id=2099126141]
transform = Transform3D(-0.99999976, 0, 8.940697e-08, 0, 1, 0, -8.940697e-08, 0, -0.99999976, 0, 0.97670054, 0)
text = "Rechtsklick zum interagieren"

[node name="Chest2" parent="NavigationRegion3D/World_fixed/Chests" unique_id=1738265254 instance=ExtResource("13_th5th")]
transform = Transform3D(-0.51225275, 0, 0.85883474, 0, 1, 0, -0.85883474, 0, -0.51225275, 4.47344, 0.8733542, 1.4947839)
chest_items = Array[ExtResource("13_7smn1")]([ExtResource("8_ou6is"), null, null, null, null, null, null, null, null, null])

[node name="ChestLabel" type="Label3D" parent="NavigationRegion3D/World_fixed/Chests" unique_id=107254116]
transform = Transform3D(0.51225257, 0, -0.8588346, 0, 1, 0, 0.8588346, 0, 0.51225257, 5.159802, 3.3580723, 3.4829926)
text = "Sammele Items
↓"
font_size = 128

[node name="CraftingTable" parent="NavigationRegion3D/World_fixed" unique_id=117519311 instance=ExtResource("2_nvumn")]
transform = Transform3D(0.55945325, 0, 0.82886183, 0, 1, 0, -0.82886183, 0, 0.55945325, -3.5366414, 0.9754207, 3.9598742)

[node name="CraftingTableLabel" type="Label3D" parent="NavigationRegion3D/World_fixed/CraftingTable" unique_id=38182501]
transform = Transform3D(0.9999999, 0, -5.9604645e-08, 0, 1, 0, 5.9604645e-08, 0, 0.9999999, 0, 3.2249587, 0)
text = "Stelle her
↓"
font_size = 128

[node name="CraftingTableLabel2" type="Label3D" parent="NavigationRegion3D/World_fixed/CraftingTable" unique_id=763927476]
transform = Transform3D(0.817326, 0, 0.5761753, 0, 1, 0, -0.5761753, 0, 0.817326, -4.7075157, 0.9602468, -2.1891649)
text = "Wähle einen Block in der Hotbar per Hotkey
aus und platzieren ihn mit Rechtsklick."

[node name="World_flexible" type="Node3D" parent="NavigationRegion3D" unique_id=331126618]

[node name="Blocks" type="Node3D" parent="NavigationRegion3D/World_flexible" unique_id=303966832]

[node name="Spawner" type="Node" parent="NavigationRegion3D" unique_id=1968525156]

[node name="Spawnpath" type="Path3D" parent="NavigationRegion3D/Spawner" unique_id=284277413]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 0)
curve = SubResource("Curve3D_necax")
debug_custom_color = Color(18.892157, 18.892157, 18.892157, 1)

[node name="Spawnpoint" type="PathFollow3D" parent="NavigationRegion3D/Spawner/Spawnpath" unique_id=660173311]
transform = Transform3D(-0.38446587, 0, 0.9231392, 0, 1, 0, -0.9231392, 0, -0.38446587, -0.18897486, 0, -48.908566)

[node name="Spawn_Timer" type="Timer" parent="NavigationRegion3D/Spawner" unique_id=72610505]

[node name="WorldEnvironment" type="WorldEnvironment" parent="." unique_id=16195839 node_paths=PackedStringArray("sun_pivot", "moon_pivot")]
environment = SubResource("Environment_0xm2m")
script = ExtResource("4_blune")
moon_max_intensity = 0.02
sun_pivot = NodePath("SunPivot")
moon_pivot = NodePath("MoonPivot")
time = 0.93

[node name="SunPivot" type="Node3D" parent="WorldEnvironment" unique_id=968404363]
transform = Transform3D(1, 0, 0, 0, 0.030730372, 0.9995277, 0, -0.9995277, 0.030730372, 0, 0, 0)

[node name="SunLight" type="DirectionalLight3D" parent="WorldEnvironment/SunPivot" unique_id=57668596]
shadow_enabled = true

[node name="MoonPivot" type="Node3D" parent="WorldEnvironment" unique_id=1135485692]

[node name="MoonLight" type="DirectionalLight3D" parent="WorldEnvironment/MoonPivot" unique_id=1937447166]
transform = Transform3D(1, 0, 0, 0, 0.99999994, 0, 0, 0, 0.99999994, 0, 44.100002, 0)
shadow_enabled = true

[node name="Player" parent="." unique_id=1560919245 instance=ExtResource("2_tipki")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 10.486757)

[node name="UI" type="CanvasLayer" parent="." unique_id=1447121957]

[node name="Coordinates" type="RichTextLabel" parent="UI" unique_id=621360325 node_paths=PackedStringArray("player")]
offset_left = 2.0
offset_right = 179.0
offset_bottom = 110.0
mouse_filter = 2
text = "x: 0
y: 0
z: 0"
scroll_active = false
script = ExtResource("3_85g3d")
player = NodePath("../../Player")

[node name="Hotbar" parent="UI" unique_id=1611156962 node_paths=PackedStringArray("player", "inventory") instance=ExtResource("4_choun")]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 2.0
offset_top = -55.0
offset_right = 42.0
offset_bottom = -15.0
grow_vertical = 0
player = NodePath("../../Player")
inventory = NodePath("../Inventory")

[node name="Crosshair" type="TextureRect" parent="UI" unique_id=223562887]
texture_filter = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -48.0
offset_top = -48.0
offset_right = -16.0
offset_bottom = -16.0
grow_horizontal = 2
grow_vertical = 2
scale = Vector2(2, 2)
texture = ExtResource("5_ya4ey")

[node name="PauseMenu" parent="UI" unique_id=1619200407 node_paths=PackedStringArray("player") instance=ExtResource("6_eb6dy")]
player = NodePath("../../Player")

[node name="Inventory" parent="UI" unique_id=1918196311 node_paths=PackedStringArray("player", "hotbar") groups=["InventoryUI"] instance=ExtResource("8_b1x3f")]
player = NodePath("../../Player")
hotbar = NodePath("../Hotbar")

[node name="MusicPlayer" type="AudioStreamPlayer" parent="." unique_id=1099075134]
stream = ExtResource("7_trceg")
volume_db = -30.0

[node name="Timer" type="Timer" parent="." unique_id=1116612803]
autostart = true

[connection signal="child_order_changed" from="NavigationRegion3D/World_flexible" to="NavigationRegion3D" method="_on_world_flexible_child_order_changed"]
[connection signal="child_order_changed" from="NavigationRegion3D/World_flexible/Blocks" to="NavigationRegion3D" method="_on_world_flexible_child_order_changed"]
[connection signal="timeout" from="Timer" to="NavigationRegion3D" method="_on_mob_timer_timeout"]
